package com.oxygen.seat;


import android.graphics.Bitmap;


public class GetImgCode {
	private static final int[][][] model = { { // 0
		{0,0,0,1,1,1,1,0},
		{0,0,1,0,0,0,1,1},
		{0,1,1,0,0,0,0,1},
		{0,1,0,0,0,0,0,1},
		{0,1,0,0,0,0,0,1},
		{1,1,0,0,0,0,1,1},
		{1,1,0,0,0,0,1,1},
		{1,1,0,0,0,0,1,0},
		{1,1,0,0,0,1,1,0},
		{0,1,0,0,0,1,0,0},
		{0,1,1,1,1,0,0,0}, }, { // 1
			{0,0,0,0,0,1,0,0},
			{0,0,0,0,1,1,0,0},
			{0,0,1,1,1,1,0,0},
			{0,0,0,0,1,1,0,0},
			{0,0,0,0,1,1,0,0},
			{0,0,0,0,1,0,0,0},
			{0,0,0,0,1,0,0,0},
			{0,0,0,0,1,0,0,0},
			{0,0,0,1,1,0,0,0},
			{0,0,0,1,1,0,0,0},
			{0,0,0,1,0,0,0,0},}, { // 2
				{0,0,1,1,1,1,1,0},
				{0,1,1,0,0,0,1,1},
				{0,1,1,0,0,0,0,1},
				{0,0,0,0,0,0,1,1},
				{0,0,0,0,0,0,1,0},
				{0,0,0,0,0,1,0,0},
				{0,0,0,1,1,0,0,0},
				{0,0,1,1,0,0,0,0},
				{0,1,1,0,0,0,0,0},
				{1,1,0,0,0,0,0,0},
				{1,1,1,1,1,1,1,0}, }, {// 3
					{0,0,1,1,1,1,1,0},
					{0,0,1,0,0,0,1,1},
					{0,0,0,0,0,0,1,1},
					{0,0,0,0,0,0,1,1},
					{0,0,0,0,1,1,1,0},
					{0,0,0,0,1,1,0,0},
					{0,0,0,0,0,0,1,0},
					{0,0,0,0,0,0,1,0},
					{1,0,0,0,0,0,1,0},
					{1,1,0,0,0,1,1,0},
					{0,1,1,1,1,1,0,0}, }, {// 4
						{0,0,0,0,0,0,1,0},
						{0,0,0,0,0,1,1,0},
						{0,0,0,0,1,1,1,0},
						{0,0,0,1,0,1,1,0},
						{0,0,1,0,0,1,1,0},
						{0,1,1,0,0,1,0,0},
						{1,1,0,0,0,1,0,0},
						{1,1,1,1,1,1,1,1},
						{0,0,0,0,1,1,0,0},
						{0,0,0,0,1,1,0,0},
						{0,0,0,0,1,0,0,0}, }, {// 5
							{0,0,1,1,1,1,1,1},
							{0,0,1,0,0,0,0,0},
							{0,0,1,0,0,0,0,0},
							{0,1,1,1,1,1,0,0},
							{0,1,1,1,0,1,1,0},
							{0,1,0,0,0,0,1,1},
							{0,0,0,0,0,0,1,1},
							{0,0,0,0,0,0,1,1},
							{1,1,0,0,0,0,1,0},
							{0,1,0,0,0,1,1,0},
							{0,1,1,1,1,1,0,0}, }, {// 6
								{0,0,0,1,1,1,1,0},
								{0,0,1,1,0,0,0,1},
								{0,1,1,0,0,0,0,0},
								{0,1,0,0,1,0,0,0},
								{0,1,1,1,1,1,1,0},
								{1,1,0,0,0,0,1,0},
								{1,1,0,0,0,0,1,1},
								{1,1,0,0,0,0,1,1},
								{1,1,0,0,0,0,1,0},
								{0,1,0,0,0,1,1,0},
								{0,0,1,1,1,1,0,0}, }, {// 7
									{0,1,1,1,1,1,1,1},
									{0,0,0,0,0,0,1,1},
									{0,0,0,0,0,1,1,0},
									{0,0,0,0,0,1,0,0},
									{0,0,0,0,1,0,0,0},
									{0,0,0,1,1,0,0,0},
									{0,0,0,1,0,0,0,0},
									{0,0,1,1,0,0,0,0},
									{0,0,1,1,0,0,0,0},
									{0,0,1,0,0,0,0,0},
									{0,1,1,0,0,0,0,0}, }, {// 8
										{0,0,1,1,1,1,1,0},
										{0,0,1,0,0,0,1,1},
										{0,1,1,0,0,0,0,1},
										{0,0,1,0,0,0,1,1},
										{0,0,1,1,1,1,1,0},
										{0,1,1,0,0,1,1,0},
										{0,1,0,0,0,0,1,0},
										{1,1,0,0,0,0,1,0},
										{1,1,0,0,0,0,1,0},
										{0,1,0,0,0,1,1,0},
										{0,1,1,1,1,1,0,0},}, {// 9
											{0,0,1,1,1,1,1,0},
											{0,1,1,0,0,0,1,0},
											{0,1,0,0,0,0,1,1},
											{0,1,0,0,0,0,1,1},
											{0,1,0,0,0,0,1,1},
											{0,1,1,0,0,1,1,1},
											{0,0,1,1,1,1,1,0},
											{0,0,0,0,0,0,1,0},
											{1,0,0,0,0,1,1,0},
											{1,1,0,0,1,1,0,0},
											{0,1,1,1,1,0,0,0}, } };

//	public static void main(String[] args) throws IOException {
//		for (int i = 0; i < 10; i++) {
//			BufferedImage image = Tools.getImage("E:/loginPic/login_" + Integer.toString(i+1) + ".jpg");
//			BufferedImage img = Tools.getSingleCode(image);
//			String code = compare(img);
//			System.out.println(code);
//		}
//	}

	public static int blackLine(Bitmap image){
		Bitmap checkCode= image;
		int[][] whiteLine = new int[28][8];
			for (int y = 0; y < 28; y++) {
				for (int x = 0; x < 8; x++) {
					int tmpRGB = ImgTools.pixelConvert(checkCode.getPixel(x,y));
					//System.out.println(tmpRGB);
					whiteLine[y][x] = tmpRGB;
				}
				for(int k = 0;k<8;k++){
					if(whiteLine[y][k] !=0){
						return y;
					}
				}
			}
			return -1;
	}
	
	public static String compare(Bitmap image) {
		Bitmap checkCode[] = ImgTools.getCheckCodes(image);
		StringBuffer code = new StringBuffer();
		
		
		for (int t = 0; t < 4; t++) {
			//System.out.println("code is :"+code);
			int startLine = blackLine(checkCode[t]);
//System.out.println("StartLine is :"+startLine);
			int[] result = new int[10];
			boolean ckFlg = false;
			int num = -1;
			for (int i = 0; i < 10; i++) {
				num = -1;
				ckFlg = true;
				for (int y = startLine; y <(startLine+11); y++) {
					
					for (int x = 0; x < 8; x++) {
						
						int expRGB = ImgTools.pixelConvert(checkCode[t].getPixel(x,y));
						int cmpRGB = model[i][y-startLine][x];
						if (expRGB == cmpRGB) { result[i]++; }
						
					}
					
				}

				if (result[i] > 85) {//result的最大值是88，此处可以调节识别精度
					ckFlg = true;
					num = i;
					break;
				}

			}
			if (ckFlg) {
				code.append(num);
				ckFlg = false;
			} else {
				ckFlg = false;
			}
		}
		return code.toString();

	}
}
